<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daftar - Simanjakon</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; }
    .input { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); color: #fff; padding: .6rem .8rem; border-radius: 6px; width:100%; }
    .input::placeholder { color: rgba(255,255,255,0.45); }
    .muted { color: rgba(255,255,255,0.6); font-size: .9rem; }
    .plan { border-radius: 8px; border:1px solid rgba(255,255,255,0.06); padding: 16px; cursor:pointer; }
    .plan.selected { box-shadow: 0 10px 30px rgba(0,0,0,0.25); transform: translateY(-4px); border-color: rgba(255,255,255,0.18); }
    .fade-up { opacity:0; transform:translateY(12px); transition: all .6s ease-out; }
    .fade-up.show { opacity:1; transform:none; }
    .label { color: #cfe4ff; font-weight:600; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#0f3a63] via-[#0d3f6b] to-[#0f4c81] text-white p-6">

  <div class="max-w-4xl mx-auto mt-8">
    <a href="index_simanjakon.html" class="inline-flex items-center text-sm mb-4 text-white/80">‚Üê Kembali ke Beranda</a>

    <div class="card p-6 fade-up" id="cardMain">
      <div class="flex items-center gap-3 mb-4">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" class="text-white/90">
          <path d="M3 13h18M3 6h18M5 20h14" stroke="#cfe4ff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <div class="text-lg font-semibold">Daftar Akun Baru</div>
          <div class="muted">Bergabunglah dengan Simanjakon untuk mengelola dokumen perusahaan Anda</div>
        </div>
      </div>

      <hr class="border-white/8 mb-6">

      <form id="regForm" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="label">Nama Lengkap</label>
            <input id="name" class="input mt-2" placeholder="Masukkan nama lengkap" required>
          </div>
          <div>
            <label class="label">Email</label>
            <input id="email" class="input mt-2" type="email" placeholder="nama@perusahaan.com" required>
          </div>

          <div class="md:col-span-2">
            <label class="label">Nomor HP</label>
            <input id="phone" class="input mt-2" placeholder="08123456789 (format 08xx atau +628xx)">
            <div class="muted text-xs mt-1">Format: 08xxxxxxxx atau +628xxxxxxxx</div>
          </div>

          <div>
            <label class="label">Nama Perusahaan</label>
            <input id="company" class="input mt-2" placeholder="PT. Nama Perusahaan">
          </div>
          <div>
            <label class="label">Tipe Pengguna</label>
            <select id="userType" class="input mt-2">
              <option value="">Pilih tipe pengguna</option>
              <option value="Kontraktor">Kontraktor</option>
              <option value="Konsultan">Konsultan</option>
              <option value="Lainnya">Lainnya</option>
            </select>
          </div>
        </div>

        <!-- Paket -->
        <div>
          <div class="label mb-2">Pilih Paket Berlangganan</div>
          <div class="grid md:grid-cols-3 gap-4">
            <div class="plan" data-plan="Basic" id="planBasic">
              <div class="text-sm font-semibold">Basic Plan</div>
              <div class="text-2xl font-bold mt-2">Rp 150.000<span class="text-sm">/bulan</span></div>
              <ul class="muted mt-2 text-sm list-disc ml-5">
                <li>5GB Storage</li>
                <li>Basic Support</li>
                <li>Standard Features</li>
              </ul>
            </div>

            <div class="plan" data-plan="Premium" id="planPremium">
              <div class="text-sm font-semibold">Premium Plan</div>
              <div class="text-2xl font-bold mt-2">Rp 300.000<span class="text-sm">/bulan</span></div>
              <ul class="muted mt-2 text-sm list-disc ml-5">
                <li>50GB Storage</li>
                <li>Priority Support</li>
                <li>Analytics</li>
              </ul>
            </div>

            <div class="plan" data-plan="Enterprise" id="planEnterprise">
              <div class="text-sm font-semibold">Enterprise Plan</div>
              <div class="text-2xl font-bold mt-2">Rp 500.000<span class="text-sm">/bulan</span></div>
              <ul class="muted mt-2 text-sm list-disc ml-5">
                <li>Unlimited Storage</li>
                <li>24/7 Support</li>
                <li>Custom Integration</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Password -->
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="label">Password</label>
            <input id="password" class="input mt-2" type="password" placeholder="Minimal 6 karakter" minlength="6" required>
          </div>
          <div>
            <label class="label">Konfirmasi Password</label>
            <input id="confirmPassword" class="input mt-2" type="password" placeholder="Ulangi password" minlength="6" required>
          </div>
        </div>

        <div>
          <button id="submitBtn" type="submit" class="w-full bg-[#1f6fd8] hover:bg-[#1b64c2] text-white py-3 rounded font-semibold">Daftar & Lanjut ke Pembayaran</button>
        </div>

        <div class="text-center muted text-sm">Sudah punya akun? <a href="#" class="text-white underline">Login di sini</a></div>

        <div id="note" class="mt-3 p-3 text-sm border border-white/8 rounded muted">
          Catatan: Akun Anda akan menunggu persetujuan admin setelah pembayaran dikonfirmasi.
        </div>

      </form>
    </div>
  </div>

  <!-- Toast / Message -->
  <div id="toast" class="fixed right-6 bottom-6 bg-[#08326a] text-white px-4 py-3 rounded shadow-lg hidden"></div>

  <script>
    // === CONFIG: Web App URL dari Apps Script ===
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwH6eJP2DLotGseO9lySVl18gLLFQ4u7UzzEXfnqaBZ6BmF1lFWeP7zqTqHYmkK58Cg/exec';

    // Plan selection
    const plans = document.querySelectorAll('.plan');
    let selectedPlan = '';
    plans.forEach(p=>{
      p.addEventListener('click', ()=>{
        plans.forEach(x=>x.classList.remove('selected'));
        p.classList.add('selected');
        selectedPlan = p.dataset.plan;
      });
    });

    // show animation
    window.addEventListener('load', ()=> {
      document.getElementById('cardMain').classList.add('show');
      document.querySelectorAll('.fade-up').forEach(el=>el.classList.add('show'));
    });

    // helper toast
    function toast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.remove('hidden');
      setTimeout(()=> t.classList.add('hidden'), 4500);
    }

    // validate phone simple
    function validPhone(p){
      if(!p) return true; // optional
      const s = p.replace(/\s+/g,'');
      return /^(\+62|62|0)\d{8,15}$/.test(s);
    }

    // hash password SHA-256
    async function hashPassword(p){
      const encoder = new TextEncoder();
      const data = encoder.encode(p);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
    }

    document.getElementById('regForm').addEventListener('submit', async (ev) => {
      ev.preventDefault();
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const company = document.getElementById('company').value.trim();
      const userType = document.getElementById('userType').value;
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirmPassword').value;

      if(!name || !email){
        return toast('Nama dan email wajib diisi');
      }
      if(password.length < 6) return toast('Password minimal 6 karakter');
      if(password !== confirm) return toast('Password konfirmasi tidak cocok');
      if(!validPhone(phone)) return toast('Format nomor telepon salah (contoh: 08123456789 atau +6281234...)');
      if(!selectedPlan) return toast('Pilih paket langganan terlebih dahulu');

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.textContent = 'Mengirim...';

      const passwordHash = await hashPassword(password);

      const payload = { name, email, phone, company, userType, plan: selectedPlan, password: passwordHash };

      try {
        const res = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: { 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if(res.ok && data.status === 'ok'){
          toast('Pendaftaran berhasil. Tunggu persetujuan admin.');
          setTimeout(()=>{ window.location.href = 'index_simanjakon.html'; }, 2500);
        } else {
          toast(data.message || 'Gagal mendaftar. Coba lagi.');
          btn.disabled = false;
          btn.textContent = 'Daftar & Lanjut ke Pembayaran';
        }
      } catch(err){
        console.error(err);
        toast('Error jaringan. Coba lagi nanti.');
        btn.disabled = false;
        btn.textContent = 'Daftar & Lanjut ke Pembayaran';
      }
    });
  </script>
</body>
</html>
